include_directories(${CMAKE_CURRENT_BINARY_DIR})

add_library(
  mirconsole OBJECT

  linux_virtual_terminal.cpp                linux_virtual_terminal.h
  logind_console_services.cpp               logind_console_services.h
  null_console_services.h
  ${CMAKE_CURRENT_BINARY_DIR}/logind-seat.c
  ${CMAKE_CURRENT_BINARY_DIR}/logind-seat.h
  ${CMAKE_CURRENT_BINARY_DIR}/logind-session.c
  ${CMAKE_CURRENT_BINARY_DIR}/logind-session.h
  default_configuration.cpp
)

set_source_files_properties(
  ${CMAKE_CURRENT_BINARY_DIR}/logind-seat.c
  ${CMAKE_CURRENT_BINARY_DIR}/logind-seat.h
  ${CMAKE_CURRENT_BINARY_DIR}/logind-session.c
  ${CMAKE_CURRENT_BINARY_DIR}/logind-session.h

# There's no need to warn about things in the autogenerated files we can't fix
  PROPERTIES
  COMPILE_FLAGS
    "${CMAKE_C_FLAGS} -Wno-unused-parameter -Wno-unused-function"
)

add_custom_command(
  OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/logind-seat.h
  COMMAND
    gdbus-codegen
    --header
    --output logind-seat.h
    --interface-prefix org.freedesktop.login1
    --c-namespace Logind
    ${CMAKE_CURRENT_SOURCE_DIR}/logind-seat.xml
  DEPENDS logind-seat.xml
)

add_custom_command(
  OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/logind-seat.c
  COMMAND
    gdbus-codegen
    --body
    --output logind-seat.c
    --interface-prefix org.freedesktop.login1
    --c-namespace Logind
    ${CMAKE_CURRENT_SOURCE_DIR}/logind-seat.xml
  DEPENDS logind-seat.xml
)

add_custom_command(
  OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/logind-session.h
  COMMAND
    gdbus-codegen
    --header
    --output logind-session.h
    --interface-prefix org.freedesktop.login1
    --c-namespace Logind
    ${CMAKE_CURRENT_SOURCE_DIR}/logind-session.xml
  DEPENDS logind-session.xml
)

add_custom_command(
  OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/logind-session.c
  COMMAND
    gdbus-codegen
    --body
    --output logind-session.c
    --interface-prefix org.freedesktop.login1
    --c-namespace Logind
    ${CMAKE_CURRENT_SOURCE_DIR}/logind-session.xml
  DEPENDS logind-session.xml
)
